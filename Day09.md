# 汚す前のテクスチャを生成する
Day8は表面を汚して無地の表面のキャプチャーを行いました。<br>
この場合にテクスチャを生成する画像はすでに汚されているので、汚れた状態のテクスチャが出来上がります。<br>
できれば汚す前のテクスチャが欲しいので今回はそのために試した方法を紹介します。<br>
確認が不十分な点はありますがご容赦ください。<br>

## Image layer
チュートリアルで紹介されている方法は、アライメントする画像とテクスチャ生成する画像を分ける方法です。<br><br>
https://support.capturingreality.com/hc/en-us/articles/360013294800-How-do-I-use-Image-layers-　
<br><br>
ここで気になるのは、アライメント用の画像とテクスチャ生成用の画像は同じカメラの位置で撮影されているという条件です。<br>
つまり被写体との相対位置が変わらない100台近いカメラとパターンプロジェクタを準備するか、パターンプロジェクタの投影前後で同じカメラ位置を再現する機械を準備する必要がありそうです。<br>
仕事であれば言い訳せずにがんばれというところですが、簡単な方法ではないと思います。<br>
<br>
## 特徴点を補助する材料をアライメントの下敷きにする
上記の方法は簡単に実現することが難しいので、別の方法を試してみました。<br>
要は汚す前後のカメラのアライメントができればよいということなので、汚す前後で回転台の同じ位置に被写体を載せ、回転台の表面のターゲットに対してカメラをアライメントするとよいと考えました。<br>
<img src="https://github.com/nakanomuramoto/AdventCalendar2020MJ/blob/main/images/Day9_1.png" width="300">
<img src="https://github.com/nakanomuramoto/AdventCalendar2020MJ/blob/main/images/Day9_2.png" width="300"><br><br>
回転台の上に突き当て部品を追加し、花瓶の角度を再現できるように目印をつけて、回転台に載せる再現性を確保しました。<br>
撮影しているカメラ位置は汚す前後で同じではありませんが回転台の上に貼っているパターンが強く抽出されるので、台の上のパターンが映っていればカメラの位置は推定されます。<br>
そして、汚した後の画像でメッシュを作り、汚す前の画像でテクスチャを作るように指定するわけです。<br>
<br>
汚す前の場合<br>
無地な表面なので部分的にメッシュができていません。<br>
<img src="https://github.com/nakanomuramoto/AdventCalendar2020MJ/blob/main/images/Day9_3.png" width="600"><br>
汚した後の場合<br>
表面の色と違う粉がタイポイントになっているので表面形状は復元しやすくなっています。<br>
<img src="https://github.com/nakanomuramoto/AdventCalendar2020MJ/blob/main/images/Day9_4.png" width="600"><br><br>
汚した後の画像でアライメントしてComponentを作った後に、汚す前の画像を1Dsにドラッグアンドドロップしてアライメントした結果がこちらです。テクスチャは汚す前の画像のみをenableにしました。<br>
<img src="https://github.com/nakanomuramoto/AdventCalendar2020MJ/blob/main/images/Day9_5.png" width="600"><br><br>
<br>
被写体が無地なので色のずれがおきているか分かりにくく検証が不十分ですが、大きなずれがなくテクスチャを貼ることができたようです。<br>

## まとめ
メッシュ作成用とテクスチャ生成用の画像をそれぞれ撮影し、被写体とは別の材料を経由してカメラ位置をアライメントすることで汚す前のテクスチャを貼る方法を紹介しました。<br>
被写体が無地なので検証が不完全なところはすみません。<br>
<br>
