# 部屋のキャプチャー
広い範囲で移動しながら広がる方向にカメラを向けて撮影するのですが、小物をキャプチャーするよりも段違いに難しいです。<br>
単純に考えても奥行き方向が深いわりに撮影時の引きじりを確保できないのでフォーカスが合わない場所ができたり、部屋の中は基本的に暗いので手ブレも起きやすかったり、難しいことばかりです。<br>
また壁が白色一色だったりするので復元したモデルがお化け屋敷のように穴だらけになりやすいです。<br>
ここでは撮影時のカメラの動かし方を比較して実験してみました。<br>
今回は部屋の一角をキャプチャーしました。<br>
<img src="https://github.com/nakanomuramoto/AdventCalendar2020MJ/blob/main/images/Day14_1.jpg" width="300"><br><br>

## 失敗する例:パノラマ撮影のようにカメラを回す
画像から奥行き情報を得るためには画像間に視差が必要だと思います。<br>
つまりパノラマ撮影のようにカメラを主点位置で回転させるだけだとうまくいかないはずです。<br>
失敗する予感しかしませんが、わざとカメラの位置を変えずにyaw方向に回転させながら撮影した画像を処理してみました。<br>
スマホカメラで27枚撮影しました。<br>
<img src="https://github.com/nakanomuramoto/AdventCalendar2020MJ/blob/main/images/Day14_2.png" width="600"><br><br>
カメラの位置推定結果も正しくなく直交する2枚の壁も丸くつながってしまいました。失敗です。<br>

## 直線状に移動しながら撮影する例
壁とほぼ同じ距離を保ちつつ、壁にカメラを向けて移動しながら撮影しました。<br>
進行方向にカメラを向けていませんが、歩きながら動画撮影したデータを使う場合に似ているかもしれません。<br>
<img src="https://github.com/nakanomuramoto/AdventCalendar2020MJ/blob/main/images/Day14_3.png" width="600"><br><br>
ピッチ方向の情報が少なくて失敗すると思いましたが意外とうまくつながりました。<br>
おそらく撮影間隔が狭く、画像間の特徴点がつながりやすいのかもしれません。<br>

## 上下左右にステレオペア作ることを意識しながら撮影する例
壁とほぼ同じ距離を保ちつつ、縦と横で30cmくらいの間隔で3回x3回移動する撮影を一つの単位として撮影したら移動する、を繰り返してみました。<br>
別の壁に渡るときは両方の面が映るように斜めに移動して撮影する部分も追加しました。<br>
立ち止まって静止画を撮影し、9枚の撮影が終わったら移動していく場合に似ているかもしれません。<br>
<img src="https://github.com/nakanomuramoto/AdventCalendar2020MJ/blob/main/images/Day14_5.png" width="600"><br><br>
直線状に移動しながら撮影する例とほぼ同等な結果になりました。ここまでやらなくても良かったようです。<br>
これくらいの違いであれば何も考えずに直線状に移動しながら撮影するだけでよいかもしれません。<br>
<br>
いずれにしても部屋の大きさやカメラとレンズの組み合わせによって結果は変わります。<br>
可能であれば現場と同じような状況で事前検証したり、その場で画像をalingmentして都度足りない画像を補うなど工夫は必要だと思います。<br>
<br><br>
平らな壁に凹凸が目立ち復元状態が悪いのですが、おそらくこれ以上頑張っても苦労のわりに改善しないような気がします。<br>
壁や床はあまり重要ではないものの穴や凹凸があると見た目が著しく劣化するので、コストパフォーマンスの観点から潔くズルをする判断もあると思います。<br>
後日、DCCツールで修正してモデルを再度Reality Captureに取り込む方法を紹介します。<br>

## まとめ
部屋の中のキャプチャーを3種類の撮影方法について試してみました。<br>
視差ができるようにカメラを移動させて撮影することが重要ですが、上下方向に分けて撮影しなくてもよい場合もありそうです。<br>
白い壁は平らに復元されなかったので、モデルをexortして修正してから再びReality Captureにimportする方法を後日試します。<br>
